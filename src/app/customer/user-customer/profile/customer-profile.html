<h1 class="title">Kunde - {{ customer()?.first_name }} {{ customer()?.last_name }}</h1>

<div class="main-wrapper">
  <div class="wrapper-content">
    <div class="profile-content">
      <!-- Photo -->
      <div class="avatar">
        <div class="avatar-img">
          <!-- Avatar -->
          @if (customer()?.image !== null) {
            <div class="user-avatar">
              <div class="pre-loader-small"></div>
              <img [src]="customer()?.image" alt="avatar" />
            </div>
          } @else {
            <div class="user-avatar">
              <div class="pre-loader-small"></div>
              <img src="./assets/profile.svg" alt="avatar" />
            </div>
          }
          <button type="button" class="edit-avatar" (click)="editAvatar()">
            <img src="./assets/edit.svg" alt="edit" />
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="main-wrapper">
  <div class="wrapper-content">
    <button (click)="pwdRecovery()" class="password">
      <span class="icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="30"
          viewBox="0 0 30 30"
          fill="none"
          stroke="black"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-key"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path
            d="M16.555 3.843l3.602 3.602a2.877 2.877 0 0 1 0 4.069l-2.643 2.643a2.877 2.877 0 0 1 -4.069 0l-.301 -.301l-6.558 6.558a2 2 0 0 1 -1.239 .578l-.175 .008h-1.172a1 1 0 0 1 -.993 -.883l-.007 -.117v-1.172a2 2 0 0 1 .467 -1.284l.119 -.13l.414 -.414h2v-2h2v-2l2.144 -2.144l-.301 -.301a2.877 2.877 0 0 1 0 -4.069l2.643 -2.643a2.877 2.877 0 0 1 4.069 0z"
          />
          <path d="M15 9h.01" />
        </svg>
      </span>
      Passwort ändern
    </button>
  </div>
</div>

<div class="main-wrapper">
  <div class="wrapper-content" [ngClass]="showEdit ? 'show-edit' : ''">
    <div class="container-customer">
      <address class="details">
        <!-- Kundennr -->
        <dl>
          <dt>Kundennr.</dt>
          <dd>{{ customer()?.customer_number }}</dd>
        </dl>

        <!-- Person -->
        <dl>
          <dt>Titel</dt>
          <dd>{{ customer()?.title }}</dd>
        </dl>

        <dl>
          <dt>Vorname</dt>
          <dd>{{ customer()?.first_name }}</dd>
        </dl>

        <dl>
          <dt>Nachname</dt>
          <dd>{{ customer()?.last_name }}</dd>
        </dl>

        <!-- Contact -->
        <dl>
          <dt>E-Mail</dt>
          <dd>
            @if (customer()?.email) {
              <a [href]="'mailto:' + customer()?.email">{{ customer()?.email }}</a>
            } @else {
              —
            }
          </dd>
        </dl>

        <dl>
          <dt>Telefon</dt>
          <dd>
            @if (customer()?.phone) {
              <a [href]="'tel:' + customer()?.phone">{{ customer()?.phone }}</a>
            } @else {
              —
            }
          </dd>
        </dl>

        <!-- Address -->
        <dl>
          <dt>Straße & Nr.</dt>
          <dd>{{ customer()?.street }} {{ customer()?.number }}</dd>
        </dl>

        <dl>
          <dt>PLZ & Stadt</dt>
          <dd>{{ customer()?.postcode }} {{ customer()?.city }}</dd>
        </dl>

        <!-- Status -->
        <dl>
          <dt>Aktiv</dt>
          <!-- <dd>{{ customer()?. ? 'Ja' : 'Nein' }}</dd> -->
        </dl>

        <dl>
          <dt>Portfolio</dt>
          <dd>{{ customer()?.has_portfolio ? 'Ja' : 'Nein' }}</dd>
        </dl>

        <dl>
          <dt>Abo</dt>
          <dd>{{ customer()?.has_subscription ? 'Ja' : 'Nein' }}</dd>
        </dl>

      </address>

      <div class="btn-container">
        <a routerLink="/customer/dashboard" class="new-customer">Zurück</a>
        <button (click)="editDetails()" class="new-customer">Bearbeiten</button>
      </div>
    </div>

    <div class="container-edit">
      <form
        [formGroup]="customerForm"
        (ngSubmit)="onSubmit()"
        [ngClass]="showEdit ? 'show-scroll' : ''"
      >
        <!-- Photo -->
        <div class="form-group">
          <label id="label-image" for="image">Photo:</label>
          <input type="file" id="image" formControlName="image" accept="image/*" />
        </div>

        <!-- Anrede (Title) -->
        <div class="form-group">
          <label class="control-label required" id="label-title" for="title">Anrede:</label>
          <select class="form-control" id="title" formControlName="title">
            <option value="">Keine Angabe</option>
            <option value="Herr">Herr</option>
            <option value="Frau">Frau</option>
            <option value="Divers">Divers</option>
          </select>
          @if (
            customerForm.get('title')?.invalid &&
            (customerForm.get('title')?.touched || customerForm.get('first_name')?.dirty)
          ) {
            <div class="text-requied">
              @if (customerForm.get('title')?.errors?.['required']) {
                <small>Anrede ist erforderlich.</small>
              }
            </div>
          }
        </div>

        <!-- First Name -->
        <div class="form-group">
          <label class="control-label required" id="label-first_name" for="first_name"
            >Vorname:</label
          >
          <input
            class="form-control"
            type="text"
            placeholder="Max"
            id="first_name"
            formControlName="first_name"
          />
          @if (
            customerForm.get('first_name')?.invalid &&
            (customerForm.get('first_name')?.touched || customerForm.get('first_name')?.dirty)
          ) {
            <div class="text-requied">
              @if (customerForm.get('first_name')?.errors?.['required']) {
                <small>Vorname ist erforderlich.</small>
              }
              @if (customerForm.get('first_name')?.errors?.['minlength']) {
                <small>Vorname muss mindestens 2 Zeichen lang sein.</small>
              }
              @if (customerForm.get('first_name')?.errors?.['pattern']) {
                <small>Vorname darf nicht nur aus Leerzeichen bestehen.</small>
              }
            </div>
          }
        </div>

        <!-- Name -->
        <div class="form-group">
          <label class="control-label required" id="label-name" for="last_name">Nachname:</label>
          <input
            class="form-control"
            type="text"
            placeholder="Mustermann"
            id="last_name"
            formControlName="last_name"
          />
          @if (
            customerForm.get('last_name')?.invalid &&
            (customerForm.get('last_name')?.touched || customerForm.get('last_name')?.dirty)
          ) {
            <div class="text-requied">
              @if (customerForm.get('last_name')?.errors?.['required']) {
                <small>Nachname ist erforderlich.</small>
              }
              @if (customerForm.get('last_name')?.errors?.['minlength']) {
                <small>Nachname muss mindestens 2 Zeichen lang sein.</small>
              }
              @if (customerForm.get('last_name')?.errors?.['pattern']) {
                <small>Nachname darf nicht nur aus Leerzeichen bestehen.</small>
              }
            </div>
          }
        </div>

        <!-- Street -->
        <div class="form-group">
          <label class="control-label required" id="label-street" for="street">Straße:</label>
          <input
            class="form-control"
            type="text"
            placeholder="Musterstrasse"
            id="street"
            formControlName="street"
          />
          @if (
            customerForm.get('street')?.invalid &&
            (customerForm.get('street')?.touched || customerForm.get('street')?.dirty)
          ) {
            <div class="text-requied">
              @if (customerForm.get('street')?.errors?.['required']) {
                <small>Straße ist erforderlich.</small>
              }
              @if (customerForm.get('street')?.errors?.['pattern']) {
                <small>Straße darf nicht nur aus Leerzeichen bestehen.</small>
              }
            </div>
          }
        </div>

        <!-- Number -->
        <div class="form-group">
          <label class="control-label required" id="label-number" for="number">Hausnummer:</label>
          <input
            class="form-control"
            type="text"
            placeholder="123"
            id="number"
            formControlName="number"
          />
          @if (
            customerForm.get('number')?.invalid &&
            (customerForm.get('number')?.touched || customerForm.get('number')?.dirty)
          ) {
            <div class="text-requied">
              @if (customerForm.get('number')?.errors?.['required']) {
                <small>Hausnummer ist erforderlich.</small>
              }
              @if (customerForm.get('number')?.errors?.['pattern']) {
                <small
                  >Hausnummer darf nur Zahlen, Buchstaben, Bindestriche oder Schrägstriche enthalten
                  (z. B. 12A, 12-14, 12/1). Keine Leerzeichen</small
                >
              }
            </div>
          }
        </div>

        <!-- Postcode -->
        <div class="form-group">
          <label class="control-label required" id="label-postcode" for="postcode"
            >Postleitzahl:</label
          >
          <input
            class="form-control"
            type="text"
            placeholder="81500"
            id="postcode"
            formControlName="postcode"
          />
          @if (
            customerForm.get('postcode')?.invalid &&
            (customerForm.get('postcode')?.touched || customerForm.get('postcode')?.dirty)
          ) {
            <div class="text-requied">
              @if (customerForm.get('postcode')?.errors?.['required']) {
                <small>Postleitzahl ist erforderlich.</small>
              }
              @if (customerForm.get('postcode')?.errors?.['pattern']) {
                <small>Postleitzahl muss aus 4 oder 5 Ziffern bestehen.</small>
              }
              @if (customerForm.get('postcode')?.errors?.['pattern']) {
                <small>Postleitzahl darf nicht nur aus Leerzeichen bestehen.</small>
              }
            </div>
          }
        </div>

        <!-- City -->
        <div class="form-group">
          <label class="control-label required" id="label-city" for="city">Stadt:</label>
          <input
            class="form-control"
            type="text"
            placeholder="MusterStadt"
            id="city"
            formControlName="city"
          />
          @if (
            customerForm.get('city')?.invalid &&
            (customerForm.get('city')?.touched || customerForm.get('city')?.dirty)
          ) {
            <div class="text-requied">
              @if (customerForm.get('city')?.errors?.['required']) {
                <small>Stadt ist erforderlich.</small>
              }

              @if (customerForm.get('city')?.errors?.['pattern']) {
                <small>Stadt darf nur Buchstaben enthalten.</small>
              }
            </div>
          }
        </div>

        <!-- Email -->
        <div class="form-group">
          <label class="control-label required" id="label-email" for="email">E-mail:</label>
          <input
            class="form-control"
            type="email"
            placeholder="maxmusterman@email.com"
            id="email"
            formControlName="email"
          />
          @if (
            customerForm.get('email')?.invalid &&
            (customerForm.get('email')?.touched || customerForm.get('email')?.dirty)
          ) {
            <div class="text-requied">
              @if (customerForm.get('email')?.errors?.['required']) {
                <small>E-Mail-Adresse ist erforderlich.</small>
              }
              @if (customerForm.get('email')?.errors?.['pattern']) {
                <small>E-Mail-Adresse darf nicht nur aus Leerzeichen bestehen.</small>
              }
              @if (customerForm.get('email')?.errors?.['email']) {
                <small
                  >Bitte geben Sie eine gültige E-Mail-Adresse ein (z. B.
                  max.mustermann@example.com).</small
                >
              }
            </div>
          }
        </div>

        <!-- Phone Number -->
        <div class="form-group">
          <label class="control-label" id="label-phone" for="phone">Telephone:</label>
          <input
            class="form-control"
            type="tel"
            placeholder="+49 176 42 56 85 45"
            id="phone"
            formControlName="phone"
          />
        </div>

        <!-- Receive Subscribtion -->
        <div class="form-group">
          <label class="control-label" id="label-has_subscription"
            >Willst du unsere Mitteilungen per E-Mail bekommen?</label
          >
          <div class="form-radio">
            <label for="has_subscriptionYes">
              <input
                class="form-control"
                type="radio"
                id="has_subscriptionYes"
                formControlName="has_subscription"
                [value]="true"
              />
              Ja
            </label>

            <label for="has_subscriptionNo">
              <input
                class="form-control"
                type="radio"
                id="has_subscriptionNo"
                formControlName="has_subscription"
                [value]="false"
              />
              Nein
            </label>
          </div>
        </div>

        <!-- Portofilo -->
        <div class="form-group">
          <label class="control-label" id="label-has_portfolio"
            >Willst du ein Profolio bei uns haben?</label
          >
          <div class="form-radio">
            <label for="has_portfolioYes">
              <input
                class="form-control"
                type="radio"
                id="has_portfolioYes"
                formControlName="has_portfolio"
                [value]="true"
              />
              Ja
            </label>

            <label for="has_portfolioNo">
              <input
                class="form-control"
                type="radio"
                id="has_portfolioNo"
                formControlName="has_portfolio"
                [value]="false"
              />
              Nein
            </label>
          </div>
        </div>
        <div class="btn-container">
          <!-- Cancel Button -->
          <button type="button" (click)="onCancel()">Abbrechen</button>

          <!-- Submit Button -->
          <button type="submit" [disabled]="!customerForm.valid">Speichern</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- <app-forgot-password (click)="closeDialog()" class="hide-container" [ngClass]="stateService.isForgotPasswordVisible ? 'show-container' : ''"> </app-forgot-password> -->
