<h1 class="title">Algorithmus</h1>

<div class="search-container">
  <input
    type="text"
    placeholder="Search customers..."
    [(ngModel)]="searchTerm"
    (input)="onSearchChange()"
    (focus)="onFocus()"
    (blur)="hideDropdown()"
  />

  @if (showDropdown) {
    <ul class="dropdown">
      @for (customer of customerControl.customers; track customer) {
        <li (click)="selectCustomer(customer)">
          {{ customer.firstName }} {{ customer.lastName }}
        </li>
      }
    </ul>
  }
</div>

<form [formGroup]="algorithmusForm" (ngSubmit)="onSubmit()">
  <div>
    <label for="summe">Summe (€):</label>
    <input
      id="summe"
      type="number"
      formControlName="Summe"
      placeholder="z. B. 1000"
    />

    @if (Summe?.touched && Summe?.invalid) {
      <div class="error">
        @if (Summe?.errors?.['required']) {
          <small>Summe ist erforderlich.</small>
        }
        @if (Summe?.errors?.['min']) {
          <small>Mindestwert ist 1 €.</small>
        }
        @if (Summe?.errors?.['pattern']) {
          <small>Bitte gültige Zahl eingeben (z. B. 1000.50).</small>
        }
      </div>
    }
  </div>

  <div class="checkboxes">
    <label for="basic-fee">
      <input id="basic-fee" type="checkbox" formControlName="basicFee" />
      Grundgebühr <span>{{algorithmusControl.basicFeeProvision | number:'1.2-2'}} €</span>
    </label>
    <label for="first-step">
      <input id="first-step" type="checkbox" formControlName="firstStep" />
      Individuelle Express Krypto-Einführung <span>{{algorithmusControl.firstStepProvision}}%</span> 
    </label>

    <label for="exchange-setup" >
      <input id="exchange-setup" type="checkbox" formControlName="exchangeSetup" />
      Börsenwahl & Einrichtung <span>{{algorithmusControl.exchangeSetupProvision}}%</span>
    </label>

    <label for="buy-strategy">
      <input id="buy-strategy" type="checkbox" formControlName="buyStrategy" />
      Kaufstrategie & Coin-Auswahl <span>{{algorithmusControl.buyStrategyProvision}}%</span>
    </label>

    <label for="wallet-setup">
      <input id="wallet-setup" type="checkbox" formControlName="walletSetup" />
      Wallet-Einrichtung & Sicherheit <span>{{algorithmusControl.walletSetupProvision}}%</span> 
    </label>

    <label for="tax-tool">
      <input id="tax-tool" type="checkbox" formControlName="taxTool" />
      Steuertool für deine Abwicklung <span>{{algorithmusControl.taxToolProvision}}%</span> 
    </label>

    <label for="ongoing-support">
      <input id="ongoing-support" type="checkbox" formControlName="ongoingSupport" />
      Laufende Betreuung <span>{{algorithmusControl.ongoingSupportProvision}}€</span> 
    </label>
  </div>

  <button type="submit" [disabled]="!algorithmusForm.valid">
    Berechnen
  </button>
</form>

<section>
  <h2>
    Zusammenfassung
  </h2>
  <table>
    <thead>
      <tr>
        <td class="first-part">
          Leistung
        </td>
        <td class="first-part">
          Gebühr
        </td>
      </tr>
    </thead>
        <div class="divider"></div>
    <tbody>
    <tr>
        <td>Grundgebühr</td>
        <td>{{algorithmusControl.basicFeeProvision | number:'1.2-2'}} €</td>
    </tr>
    <tr>
      <td>Individuelle Express Krypto-Einführung <span>({{algorithmusControl.firstStepProvision}}%)</span></td>
      <td>{{firstStepAmount | number:'1.2-2'}} €</td>
    </tr>
    <tr>
      <td>Börsenwahl & Einrichtung <span>({{algorithmusControl.exchangeSetupProvision}}%)</span></td>
      <td>{{exchangeSetupAmount| number:'1.2-2'}} €</td>
    </tr>
    <tr>
      <td> Kaufstrategie & Coin-Auswahl ({{algorithmusControl.buyStrategyProvision}}%)</td>
      <td>{{buyStrategyAmount | number:'1.2-2'}} €</td>
    </tr>
    <tr>
      <td>Wallet-Einrichtung & Sicherheit ({{algorithmusControl.walletSetupProvision}}%)</td>
      <td>{{walletSetupAmount | number:'1.2-2'}} €</td>
    </tr>
    <tr>
      <td>Steuertool für deine Abwicklung ({{algorithmusControl.taxToolProvision}}%)</td>
      <td>{{taxToolAmount | number:'1.2-2'}} €</td>
    </tr>
    <tr>
      <td>Laufende Betreuung ({{algorithmusControl.ongoingSupportProvision}}€)</td>
      <td>{{ongoingSupportAmount | number:'1.2-2'}} €</td> 
    </tr>
    
    <div class="divider"></div>

      <tr>
      <td>Investitions Betrag</td>
      <td>{{ investmentAmount | number:'1.2-2' }} €</td>
      </tr>

      <tr>
        <td>Provison</td>
        <td>{{ totalProvision | number:'1.2-2' }} €</td>
      </tr>

    <div class="divider"></div>

      <tr>
        <td>Mehrwertsteuer(19%)</td>
        <td>{{ valueAddedTax | number:'1.2-2' }} €</td>
      </tr>
        
    <div class="divider"></div>

    <tr>
      <td>Total Betrag</td>
      <td>{{ totalAmount | number:'1.2-2'}} €</td>
    </tr>
  </tbody>
  </table>

</section>

  <button type="submit" [disabled]="!algorithmusForm.valid">
    Rechnung erstellen
  </button>
